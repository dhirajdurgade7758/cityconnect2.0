{% extends 'core/base.html' %}
{% load static %}

{% block title %}CivicFeed - Professional Community Complaint Platform{% endblock %}

{% block content %}


<!-- Main Content -->
<div class="container">
    <div id="complaints-container">
    {% for post in posts %}
        {% include 'issues/partials/post_card.html' %}
    {% empty %}
        <div class="empty-state">
            <div class="empty-icon">ðŸ’¬</div>
            <h5>No issues reported yet</h5>
            <p>Be the first to report a civic issue in your area</p>
            <a href="{% url 'create_issue_post' %}" class="btn btn-primary">Report an Issue</a>
        </div>
    {% endfor %}
    </div>
</div>
<div id="comment-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Comments</h2>
            <button class="close-btn" onclick="closeCommentModal(event)">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="modal-body">
            <div id="modal-complaint-info"></div>
            <div class="comments-section">
                <h3>Comments</h3>
                <div id="comments-list" 
                     hx-trigger="loadComments from:body" 
                     hx-swap="innerHTML">
                     <!-- Loading spinner while comments load -->
                    <div class="loading-spinner">
                        <i class="bi bi-arrow-repeat"></i>
                        Loading comments...
                    </div> 
                </div>
            </div>
            <div id="comment-form-container"
     hx-trigger="loadComments from:body"
     hx-swap="innerHTML">
                <!-- Form will load here -->
            </div>
        </div>
    </div>
</div>
<!-- Add this in the head section -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="{% static 'css/feed.css' %}">
<script src="{% static 'js/feed.js' %}"></script>
<script>
    document.body.addEventListener('htmx:configRequest', (event) => {
        // Include CSRF token in all HTMX requests
        event.detail.headers['X-CSRFToken'] = "{{ csrf_token }}";
    });
</script>
{% endblock %}