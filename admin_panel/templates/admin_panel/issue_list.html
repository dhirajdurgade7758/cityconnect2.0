{% extends 'admin_panel/base.html' %}

{% block title %}Reported Issues{% endblock title %}

{% block content %}
<div class="container-fluid p-4">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-white py-3 d-flex flex-wrap justify-content-between align-items-center">
      <h4 class="mb-0 fw-bold">
        <i class="bi bi-journal-text me-2 text-primary"></i>Reported Issues Tracker
      </h4>
      <div class="btn-group" role="group" aria-label="Status filter">
        <a href="{% url 'issue_list' %}" class="btn {% if not request.GET.status %}btn-primary{% else %}btn-outline-primary{% endif %}">All</a>
        <a href="?status=pending" class="btn {% if request.GET.status == 'pending' %}btn-primary{% else %}btn-outline-primary{% endif %}">Pending</a>
        <a href="?status=in_progress" class="btn {% if request.GET.status == 'in_progress' %}btn-primary{% else %}btn-outline-primary{% endif %}">In Progress</a>
        <a href="?status=resolved" class="btn {% if request.GET.status == 'resolved' %}btn-primary{% else %}btn-outline-primary{% endif %}">Resolved</a>
      </div>
    </div>

    <div class="card-body">
      {% if issues %}
      <div class="table-responsive">
        <table id="issuesTable" class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Issue Title</th>
              <th>Department</th>
              <th>Status</th>
              <th>Reported By</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for issue in issues %}
            <tr>
              <td>
                <div class="fw-bold">{{ issue.title }}</div>
                <small class="text-muted">ID: #{{ issue.id }}</small>
              </td>
              <td>
                <i class="bi bi-building me-1 text-secondary"></i>{{ issue.get_department_display }}
              </td>
              <td>
                {# Using modern, subtle badge styles from Bootstrap 5.3 #}
                <span class="badge rounded-pill fs-6
                  {% if issue.status == 'resolved' %} bg-success-subtle text-success-emphasis border border-success-subtle
                  {% elif issue.status == 'in_progress' %} bg-warning-subtle text-warning-emphasis border border-warning-subtle
                  {% else %} bg-danger-subtle text-danger-emphasis border border-danger-subtle
                  {% endif %}">
                  {{ issue.get_status_display|capfirst }}
                </span>
              </td>
              <td>
                <i class="bi bi-person me-1 text-secondary"></i>{{ issue.user.username }}
              </td>
              <td class="text-center">
                <a href="{% url 'resolve_issue' issue.id %}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-pencil-square me-1"></i>View / Update
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        {# A more visually appealing empty state #}
        <div class="text-center py-5">
            <i class="bi bi-check-circle-fill fs-1 text-success"></i>
            <h4 class="mt-3">All Clear!</h4>
            <p class="text-muted">No issues match the current filter.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}


{% block extra_scripts %}
{# This script turns your table into an interactive DataTable with search, sort, and pagination #}
<script>
  $(document).ready(function () {
    $('#issuesTable').DataTable({
      "pageLength": 10,
      "order": [] // Disables initial sorting
    });
  });
</script>
{% endblock %}