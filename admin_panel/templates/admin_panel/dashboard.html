{% extends 'admin_panel/base.html' %}
{% comment %} <h1>{{ department|capfirst }} Department Dashboard</h1>
<a href="{% url 'admin_logout' %}">Logout</a>
<a href="{% url "my_map_view" %}">view issues on map</a>


<table border="1">
  <thead>
    <tr>
      <th>Title</th>
      <th>Reported Location</th>
      <th>view on map</th>
      <th>Status</th>
      <th>Created At</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody>
    {% for issue in issues %}
    <tr>
      <td>{{ issue.title }}</td>
      <td>{{ issue.location_name }}</td>
      <td><a href="{{issue.location_map_url}}">View on Map</a></td>
      <td>{{ issue.get_status_display }}</td>
      <td>{{ issue.created_at }}</td>
      <td><a href="{% url 'issue_detail' department issue.id %}">View / Update</a></td>
    </tr>
    {% empty %}
    <tr><td colspan="5">No issues found.</td></tr>
    {% endfor %}
  </tbody>
</table> {% endcomment %}



{% load static %}

{% block title %}{{ department|capfirst }} Department Dashboard{% endblock title %}

{% block extra_head %}
{# Custom styles for the stats cards #}
<style>
  .stat-card .card-body {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .stat-card .display-4 {
    font-weight: 700;
  }
  .stat-card i {
    font-size: 2.5rem;
    opacity: 0.3;
  }
  .border-start-primary { border-left: 5px solid var(--bs-primary); }
  .border-start-danger { border-left: 5px solid var(--bs-danger); }
  .border-start-warning { border-left: 5px solid var(--bs-warning); }
  .border-start-success { border-left: 5px solid var(--bs-success); }
</style>
{% endblock extra_head %}


{% block content %}
<div class="container-fluid p-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-0">Welcome to the **{{ department|capfirst }} Department**</h1>
      <p class="text-muted mb-0">Live overview of citizen-reported issues for Gwalior.</p>
    </div>
    <a href="{% url 'my_map_view' %}" class="btn btn-lg btn-outline-primary d-none d-md-inline-flex">
      <i class="bi bi-map me-2"></i>View Issues on Map
    </a>
  </div>

  {# Note: You'll need to pass these counts from your view #}
  <div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card shadow-sm border-start-primary">
        <div class="card-body">
          <div>
            <div class="text-muted text-uppercase small">Total Issues</div>
            <span class="display-4">{{ issues.count }}</span>
          </div>
          <i class="bi bi-journal-text"></i>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card shadow-sm border-start-danger">
        <div class="card-body">
          <div>
            <div class="text-muted text-uppercase small">Pending Review</div>
            <span class="display-4">{{ pending_count|default:'0' }}</span>
          </div>
          <i class="bi bi-exclamation-triangle"></i>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card shadow-sm border-start-warning">
        <div class="card-body">
          <div>
            <div class="text-muted text-uppercase small">In Progress</div>
            <span class="display-4">{{ in_progress_count|default:'0' }}</span>
          </div>
          <i class="bi bi-tools"></i>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card shadow-sm border-start-success">
        <div class="card-body">
          <div>
            <div class="text-muted text-uppercase small">Resolved</div>
            <span class="display-4">{{ resolved_count|default:'0' }}</span>
          </div>
          <i class="bi bi-check2-circle"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Issue Tracker</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table id="issuesTable" class="table table-striped table-hover" style="width:100%">
          <thead class="table-light">
            <tr>
              <th>Title</th>
              <th>Location</th>
              <th>Status</th>
              <th>Reported On</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for issue in issues %}
            <tr>
              <td><strong>{{ issue.title }}</strong></td>
              <td>
                <a href="{{issue.location_map_url}}" target="_blank" class="text-decoration-none">
                  <i class="bi bi-geo-alt-fill me-1 text-danger"></i>{{ issue.location_name }}
                </a>
              </td>
              <td>
                {# Dynamic Status Badges for quick visual scanning #}
                <span class="badge rounded-pill fs-6
                  {% if issue.status == 'Resolved' %} bg-success-subtle text-success-emphasis border border-success-subtle
                  {% elif issue.status == 'In Progress' %} bg-warning-subtle text-warning-emphasis border border-warning-subtle
                  {% else %} bg-danger-subtle text-danger-emphasis border border-danger-subtle
                  {% endif %}">
                  {{ issue.get_status_display }}
                </span>
              </td>
              <td>{{ issue.created_at|date:"d M Y, P" }}</td>
              <td>
                <a href="{% url 'resolve_issue' issue.id %}" class="btn btn-primary btn-sm">
                  <i class="bi bi-pencil-square me-1"></i>View / Update
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center py-5">
                <i class="bi bi-check-circle-fill fs-1 text-success"></i>
                <h4 class="mt-2">All Clear!</h4>
                <p class="text-muted">No issues found for this department.</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock content %}


{% block extra_scripts %}
{# Initialize the interactive DataTable #}
<script>
  $(document).ready(function () {
    // This line turns your simple table into a powerful, interactive one
    $('#issuesTable').DataTable({
      "order": [[ 3, "desc" ]], // Default sort by the 'Reported On' column, newest first
      "pageLength": 10 // Show 10 entries per page
    });
  });
</script>
{% endblock extra_scripts %}